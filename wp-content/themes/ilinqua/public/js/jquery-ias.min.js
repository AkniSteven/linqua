define(["jquery"],function(t){var i=function(t){return this.list=[],this.fireStack=[],this.isFiring=!1,this.isDisabled=!1,this.fire=function(t){var i=t[0],e=t[1],r=t[2];this.isFiring=!0;for(var n=0,s=this.list.length;s>n;n++)if(void 0!=this.list[n]&&!1===this.list[n].fn.apply(i,r)){e.reject();break}this.isFiring=!1,e.resolve(),this.fireStack.length&&this.fire(this.fireStack.shift())},this.inList=function(t,i){for(var e=i=i||0,r=this.list.length;r>e;e++)if(this.list[e].fn===t||t.guid&&this.list[e].fn.guid&&t.guid===this.list[e].fn.guid)return e;return-1},this};i.prototype={add:function(t,i){var e={fn:t,priority:i};i=i||0;for(var r=0,n=this.list.length;n>r;r++)if(i>this.list[r].priority)return this.list.splice(r,0,e),this;return this.list.push(e),this},remove:function(t){for(var i=0;(i=this.inList(t,i))>-1;)this.list.splice(i,1);return this},has:function(t){return this.inList(t)>-1},fireWith:function(i,e){var r=t.Deferred();return this.isDisabled?r.reject():(e=e||[],e=[i,r,e.slice?e.slice():e],this.isFiring?this.fireStack.push(e):this.fire(e),r)},disable:function(){this.isDisabled=!0},enable:function(){this.isDisabled=!1}},function(t){"use strict";var e=function(e,r){return this.itemsContainerSelector=r.container,this.itemSelector=r.item,this.nextSelector=r.next,this.paginationSelector=r.pagination,this.$scrollContainer=e,this.$container=window===e.get(0)?t(document):e,this.defaultDelay=r.delay,this.negativeMargin=r.negativeMargin,this.nextUrl=null,this.isBound=!1,this.isPaused=!1,this.isInitialized=!1,this.jsXhr=!1,this.listeners={next:new i(t),load:new i(t),loaded:new i(t),render:new i(t),rendered:new i(t),scroll:new i(t),noneLeft:new i(t),ready:new i(t)},this.extensions=[],this.scrollHandler=function(){if(this.isBound&&!this.isPaused){var t=this.getCurrentScrollOffset(this.$scrollContainer),i=this.getScrollThreshold();-1!=i&&(this.fire("scroll",[t,i]),t>=i&&this.next())}},this.getItemsContainer=function(){return t(this.itemsContainerSelector,this.$container)},this.getLastItem=function(){return t(this.itemSelector,this.getItemsContainer().get(0)).last()},this.getFirstItem=function(){return t(this.itemSelector,this.getItemsContainer().get(0)).first()},this.getScrollThreshold=function(t){var i;return t=t||this.negativeMargin,t=t>=0?-1*t:t,0===(i=this.getLastItem()).length?-1:i.offset().top+i.height()+t},this.getCurrentScrollOffset=function(t){var i=0,e=t.height();return i=window===t.get(0)?t.scrollTop():t.offset().top,(-1!=navigator.platform.indexOf("iPhone")||-1!=navigator.platform.indexOf("iPod"))&&(e+=80),i+e},this.getNextUrl=function(i){return i=i||this.$container,t(this.nextSelector,i).last().attr("href")},this.load=function(i,e,r){var n,s,o=this,h=[],a=+new Date;r=r||this.defaultDelay;var A={url:i};return o.fire("load",[A]),this.jsXhr=t.get(A.url,null,t.proxy(function(i){0===(n=t(this.itemsContainerSelector,i).eq(0)).length&&(n=t(i).filter(this.itemsContainerSelector).eq(0)),n&&n.find(this.itemSelector).each(function(){h.push(this)}),o.fire("loaded",[i,h]),e&&(s=+new Date-a,r>s?setTimeout(function(){e.call(o,i,h)},r-s):e.call(o,i,h))},o),"html"),this.jsXhr},this.render=function(i,e){var r=this,n=this.getLastItem(),s=0,o=this.fire("render",[i]);o.done(function(){t(i).hide(),n.after(i),t(i).fadeIn(400,function(){++s<i.length||(r.fire("rendered",[i]),e&&e())})}),o.fail(function(){e&&e()})},this.hidePagination=function(){this.paginationSelector&&t(this.paginationSelector,this.$container).hide()},this.restorePagination=function(){this.paginationSelector&&t(this.paginationSelector,this.$container).show()},this.throttle=function(i,e){var r,n,s=0;return r=function(){function t(){s=+new Date,i.apply(r,o)}var r=this,o=arguments,h=+new Date-s;n?clearTimeout(n):t(),h>e?t():n=setTimeout(t,e)},t.guid&&(r.guid=i.guid=i.guid||t.guid++),r},this.fire=function(t,i){return this.listeners[t].fireWith(this,i)},this.pause=function(){this.isPaused=!0},this.resume=function(){this.isPaused=!1},this};e.prototype.initialize=function(){if(this.isInitialized)return!1;var t=!!("onscroll"in this.$scrollContainer.get(0)),i=this.getCurrentScrollOffset(this.$scrollContainer),e=this.getScrollThreshold();return!!t&&(this.hidePagination(),this.bind(),this.fire("ready"),this.nextUrl=this.getNextUrl(),i>=e?(this.next(),this.one("rendered",function(){this.isInitialized=!0})):this.isInitialized=!0,this)},e.prototype.reinitialize=function(){this.isInitialized=!1,this.unbind(),this.initialize()},e.prototype.bind=function(){if(!this.isBound){this.$scrollContainer.on("scroll",t.proxy(this.throttle(this.scrollHandler,150),this));for(var i=0,e=this.extensions.length;e>i;i++)this.extensions[i].bind(this);this.isBound=!0,this.resume()}},e.prototype.unbind=function(){if(this.isBound){this.$scrollContainer.off("scroll",this.scrollHandler);for(var t=0,i=this.extensions.length;i>t;t++)void 0!==this.extensions[t].unbind&&this.extensions[t].unbind(this);this.isBound=!1}},e.prototype.destroy=function(){try{this.jsXhr.abort()}catch(t){}this.unbind(),this.$scrollContainer.data("ias",null)},e.prototype.on=function(i,e,r){if(void 0===this.listeners[i])throw new Error('There is no event called "'+i+'"');return r=r||0,this.listeners[i].add(t.proxy(e,this),r),this},e.prototype.one=function(t,i){var e=this,r=function(){e.off(t,i),e.off(t,r)};return this.on(t,i),this.on(t,r),this},e.prototype.off=function(t,i){if(void 0===this.listeners[t])throw new Error('There is no event called "'+t+'"');return this.listeners[t].remove(i),this},e.prototype.next=function(){var t=this.nextUrl,i=this;if(this.pause(),!t)return this.fire("noneLeft",[this.getLastItem()]),this.listeners.noneLeft.disable(),i.resume(),!1;var e=this.fire("next",[t]);return e.done(function(){i.load(t,function(t,e){i.render(e,function(){i.nextUrl=i.getNextUrl(t),i.resume()})})}),e.fail(function(){i.resume()}),!0},e.prototype.extension=function(t){if(void 0===t.bind)throw new Error('Extension doesn\'t have required method "bind"');return void 0!==t.initialize&&t.initialize(this),this.extensions.push(t),this.isInitialized&&this.reinitialize(),this},t.ias=function(i){var e=t(window);return e.ias.apply(e,arguments)},t.fn.ias=function(i){var r=Array.prototype.slice.call(arguments),n=this;return this.each(function(){var s=t(this),o=s.data("ias"),h=t.extend({},t.fn.ias.defaults,s.data(),"object"==typeof i&&i);if(o||(s.data("ias",o=new e(s,h)),t(document).ready(t.proxy(o.initialize,o))),"string"==typeof i){if("function"!=typeof o[i])throw new Error('There is no method called "'+i+'"');r.shift(),o[i].apply(o,r)}n=o}),n},t.fn.ias.defaults={item:".item",container:".listing",next:".next",pagination:!1,delay:600,negativeMargin:10}}(jQuery);var e=function(t){return t=jQuery.extend({},this.defaults,t),this.ias=null,this.prevSelector=t.prev,this.prevUrl=null,this.listeners={prev:new i},this.onPageChange=function(t,i,e){if(window.history&&window.history.replaceState){var r=history.state;history.replaceState(r,document.title,e)}},this.onScroll=function(t,i){var e=this.getScrollThresholdFirstItem();this.prevUrl&&(t-=this.ias.$scrollContainer.height(),e>=t&&this.prev())},this.onReady=function(){var t=this.ias.getCurrentScrollOffset(this.ias.$scrollContainer);this.getScrollThresholdFirstItem()>=(t-=this.ias.$scrollContainer.height())&&this.prev()},this.getPrevUrl=function(t){return t||(t=this.ias.$container),jQuery(this.prevSelector,t).last().attr("href")},this.getScrollThresholdFirstItem=function(){var t;return 0===(t=this.ias.getFirstItem()).length?-1:t.offset().top},this.renderBefore=function(t,i){var e=this.ias,r=e.getFirstItem(),n=0;e.fire("render",[t]),jQuery(t).hide(),r.before(t),jQuery(t).fadeIn(400,function(){++n<t.length||(e.fire("rendered",[t]),i&&i())})},this};e.prototype.initialize=function(t){var i=this;this.ias=t,jQuery.extend(t.listeners,this.listeners),t.prev=function(){return i.prev()},this.prevUrl=this.getPrevUrl()},e.prototype.bind=function(t){t.on("pageChange",jQuery.proxy(this.onPageChange,this)),t.on("scroll",jQuery.proxy(this.onScroll,this)),t.on("ready",jQuery.proxy(this.onReady,this))},e.prototype.unbind=function(t){t.off("pageChange",this.onPageChange),t.off("scroll",this.onScroll),t.off("ready",this.onReady)},e.prototype.prev=function(){var t=this.prevUrl,i=this,e=this.ias;if(!t)return!1;e.pause();var r=e.fire("prev",[t]);return r.done(function(){e.load(t,function(t,r){i.renderBefore(r,function(){i.prevUrl=i.getPrevUrl(t),e.resume(),i.prevUrl&&i.prev()})})}),r.fail(function(){e.resume()}),!0},e.prototype.defaults={prev:".prev"};var r=function(t){return t=jQuery.extend({},this.defaults,t),this.ias=null,this.uid=(new Date).getTime(),this.html=t.html.replace("{text}",t.text),this.showNoneLeft=function(){var t=jQuery(this.html).attr("id","ias_noneleft_"+this.uid);this.ias.getLastItem().after(t),t.fadeIn()},this};r.prototype.bind=function(t){this.ias=t,t.on("noneLeft",jQuery.proxy(this.showNoneLeft,this))},r.prototype.unbind=function(t){t.off("noneLeft",this.showNoneLeft)},r.prototype.defaults={text:"You reached the end.",html:'<div class="ias-noneleft" style="text-align: center;">{text}</div>'};var n=function(){return this.ias=null,this.pagebreaks=[[0,document.location.toString()]],this.lastPageNum=1,this.enabled=!0,this.listeners={pageChange:new i},this.onScroll=function(t,i){if(this.enabled){var e,r=this.ias,n=this.getCurrentPageNum(t),s=this.getCurrentPagebreak(t);this.lastPageNum!==n&&(e=s[1],r.fire("pageChange",[n,t,e])),this.lastPageNum=n}},this.onNext=function(t){var i=this.ias.getCurrentScrollOffset(this.ias.$scrollContainer);this.pagebreaks.push([i,t]);var e=this.getCurrentPageNum(i)+1;this.ias.fire("pageChange",[e,i,t]),this.lastPageNum=e},this.onPrev=function(t){var i=this,e=i.ias,r=e.getCurrentScrollOffset(e.$scrollContainer)-e.$scrollContainer.height(),n=e.getFirstItem();this.enabled=!1,this.pagebreaks.unshift([0,t]),e.one("rendered",function(){for(var s=1,o=i.pagebreaks.length;o>s;s++)i.pagebreaks[s][0]=i.pagebreaks[s][0]+n.offset().top;var h=i.getCurrentPageNum(r)+1;e.fire("pageChange",[h,r,t]),i.lastPageNum=h,i.enabled=!0})},this};n.prototype.initialize=function(t){this.ias=t,jQuery.extend(t.listeners,this.listeners)},n.prototype.bind=function(t){try{t.on("prev",jQuery.proxy(this.onPrev,this),this.priority)}catch(t){}t.on("next",jQuery.proxy(this.onNext,this),this.priority),t.on("scroll",jQuery.proxy(this.onScroll,this),this.priority)},n.prototype.unbind=function(t){try{t.off("prev",this.onPrev)}catch(t){}t.off("next",this.onNext),t.off("scroll",this.onScroll)},n.prototype.getCurrentPageNum=function(t){for(var i=this.pagebreaks.length-1;i>0;i--)if(t>this.pagebreaks[i][0])return i+1;return 1},n.prototype.getCurrentPagebreak=function(t){for(var i=this.pagebreaks.length-1;i>=0;i--)if(t>this.pagebreaks[i][0])return this.pagebreaks[i];return null},n.prototype.priority=500;var s=function(t){return t=jQuery.extend({},this.defaults,t),this.ias=null,this.uid=(new Date).getTime(),this.src=t.src,this.html=t.html.replace("{src}",this.src),this.showSpinner=function(){var t=this.getSpinner()||this.createSpinner();this.ias.getLastItem().after(t),t.fadeIn()},this.showSpinnerBefore=function(){var t=this.getSpinner()||this.createSpinner();this.ias.getFirstItem().before(t),t.fadeIn()},this.removeSpinner=function(){this.hasSpinner()&&this.getSpinner().remove()},this.getSpinner=function(){var t=jQuery("#ias_spinner_"+this.uid);return t.length>0&&t},this.hasSpinner=function(){return jQuery("#ias_spinner_"+this.uid).length>0},this.createSpinner=function(){var t=jQuery(this.html).attr("id","ias_spinner_"+this.uid);return t.hide(),t},this};s.prototype.bind=function(t){this.ias=t,t.on("next",jQuery.proxy(this.showSpinner,this)),t.on("render",jQuery.proxy(this.removeSpinner,this));try{t.on("prev",jQuery.proxy(this.showSpinnerBefore,this))}catch(t){}},s.prototype.unbind=function(t){t.off("next",this.showSpinner),t.off("render",this.removeSpinner);try{t.off("prev",this.showSpinnerBefore)}catch(t){}},s.prototype.defaults={src:"data:image/gif;base64,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",html:'<div class="ias-spinner" style="text-align: center;"><img src="{src}"/></div>'};var o=function(t){return t=jQuery.extend({},this.defaults,t),this.ias=null,this.html=t.html.replace("{text}",t.text),this.htmlPrev=t.htmlPrev.replace("{text}",t.textPrev),this.enabled=!0,this.count=0,this.offset=t.offset,this.$triggerNext=null,this.$triggerPrev=null,this.showTriggerNext=function(){if(!this.enabled)return!0;if(!1===this.offset||++this.count<this.offset)return!0;var t=this.$triggerNext||(this.$triggerNext=this.createTrigger(this.next,this.html));return this.ias.getLastItem().after(t),t.fadeIn(),!1},this.showTriggerPrev=function(){if(!this.enabled)return!0;var t=this.$triggerPrev||(this.$triggerPrev=this.createTrigger(this.prev,this.htmlPrev));return this.ias.getFirstItem().before(t),t.fadeIn(),!1},this.onRendered=function(){this.enabled=!0},this.createTrigger=function(t,i){var e,r=(new Date).getTime();return i=i||this.html,(e=jQuery(i).attr("id","ias_trigger_"+r)).hide(),e.on("click",jQuery.proxy(t,this)),e},this};o.prototype.bind=function(t){this.ias=t,t.on("next",jQuery.proxy(this.showTriggerNext,this),this.priority),t.on("rendered",jQuery.proxy(this.onRendered,this),this.priority);try{t.on("prev",jQuery.proxy(this.showTriggerPrev,this),this.priority)}catch(t){}},o.prototype.unbind=function(t){t.off("next",this.showTriggerNext),t.off("rendered",this.onRendered);try{t.off("prev",this.showTriggerPrev)}catch(t){}},o.prototype.next=function(){this.enabled=!1,this.ias.pause(),this.$triggerNext&&(this.$triggerNext.remove(),this.$triggerNext=null),this.ias.next()},o.prototype.prev=function(){this.enabled=!1,this.ias.pause(),this.$triggerPrev&&(this.$triggerPrev.remove(),this.$triggerPrev=null),this.ias.prev()},o.prototype.defaults={text:"Load more items",html:'<div class="ias-trigger ias-trigger-next" style="text-align: center; cursor: pointer;"><a>{text}</a></div>',textPrev:"Load previous items",htmlPrev:'<div class="ias-trigger ias-trigger-prev" style="text-align: center; cursor: pointer;"><a>{text}</a></div>',offset:0},o.prototype.priority=1e3});